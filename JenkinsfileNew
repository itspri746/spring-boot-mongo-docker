pipeline {
    agent {
        docker {
            image 'maven:3.8.1-adoptopenjdk-11' 
            args '-v /root/.m2:/root/.m2' 
        }
    }
    stages {
        stage('Build') { 
            steps {
                sh 'mvn -B -DskipTests clean package' 
            }
        }
    }
}
    
   
    
    stage('Build Docker Image'){
        steps {
        sh 'docker rmi -f pkw0301/spring-boot-mongo'
        sh 'docker build -t pkw0301/spring-boot-mongo .'
    }}
    

    
    stage {'push docker image to ACr/Dcokerhub'}
    { steps { // This step should not normally be used in your script. Consult the inline help for details.
withDockerRegistry(credentialsId: 'DOCKERHUB', url: 'https://index.docker.io/v1/') {
   sh 'docker push pkw0301/spring-boot-mongo'
} }}
     
     
     stage("Deploy To Kuberates Cluster"){
         steps {
  kubernetesDeploy configs: 'springBootMongo.yml', kubeConfig: [path: ''], kubeconfigId: 'kubeconfig', secretName: '', ssh: [sshCredentialsId: '*', sshServer: ''], textCredentials: [certificateAuthorityData: '', clientCertificateData: '', clientKeyData: '', serverUrl: 'https://']
     }}
	 
    
}
}

